<!DOCTYPE html>
<html style="max-height: 100%; overflow-y: auto;">
  <head>
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.x/css/materialdesignicons.min.css" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="style.css">
    <title>Inventory App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui"/>
  </head>

  <body>
    <div id="app" v-cloak>
      <v-app >
        <!--========= Page Card ==============-->
        <v-card v-bind:class="{'logIn': !loggedIn}"  >

          <!-- ==============login page============= -->
          <v-container fluid v-if="!loggedIn">
            <v-row justify="center" style="height: 100vh" >
              <v-col class="fill-height d-flex flex-column justify-center align-center" cols="auto">
                <v-card class="mx-auto my-auto" width="500px">
                  <!-- <v-row > -->
                  <h1 class="py-6 px-5 deep-purple lighten-2 text-center">Login</h1>
                  <!-- </v-row> -->
                  <v-row class="px-8 mt-4 mb-2">
                    <v-icon class="mr-2"> mdi-account-box</v-icon>
                    <v-text-field type="text" placeholder="Username" v-model="username">
                  </v-row>
                  <v-row class="px-8 mb-2">
                    <v-icon class="mr-2">
                      mdi-lock
                    </v-icon>
                    <v-text-field type="password" placeholder="Password" v-model="password" autofocus @keypress.enter="login(username, password)">
                  </v-row>
                  <v-row>
                    <v-btn class="mx-16 mb-8" @click="login(username, password)">Login</button>
                  </v-row>
                  <v-row class="justify-center" v-show="invalidLogin">
                    <v-alert type="error">
                    Invalid Attempt {{ incorrectLoginAttempts }}
                    </v-alert>
                  </v-row>
                </v-card>
                <v-btn href="mailto:d00439987@dmail.dixie.edu" class="grey white--text"><h3>Contact Us</h3></v-btn>          
              </v-col>
            </v-row>
          </v-container>
          
          <!--===== Nav & Menu bar with image =====-->
          <v-container v-show="loggedIn" fluid id="scrolling-techniques-3" style="max-height: 100vh; overflow-y: auto;">
            <v-app-bar absolute color="#6A76AB" 
                      dark 
                      shrink-on-scroll 
                      prominent
                      src="https://images.alphacoders.com/265/265693.png" 
                      fade-img-on-scroll
                      scroll-target="#scrolling-techniques-3"
                      app>
              <!-- Gradient Template -->
              <template v-slot:img="{ props }">
                <v-img v-bind="props"
                      gradient="to top right, rgba(100,115,201,.7), rgba(25,32,72,.7)">
                </v-img>
              </template>

              <!-- PlaceHolder for future expansion menu -->
              <!-- <v-app-bar-nav-icon></v-app-bar-nav-icon> -->

              <v-btn icon disabled>
                <v-icon>mdi-cards</v-icon>
              </v-btn>

              <!-- Current Page title -->
              <v-app-bar-title class="float-left pr-10 ml-2 font-weight-black">{{ currentPage }}</v-app-bar-title>
              
              <v-spacer></v-spacer>

              <v-btn href="mailto:d00439987@dmail.dixie.edu" icon>
                <v-icon>mdi-email</v-icon>
              </v-btn>
        
              <v-btn icon>
                <v-icon>mdi-account-box </v-icon>
              </v-btn>

              <v-btn icon @Click="loggedIn = false">
                <v-icon>mdi-logout</v-icon>
              </v-btn>

              <!--=== Template for tabs ===-->
              <template v-slot:extension>

                <!-- For loop going through pages (list of pages) and into tab -->
                <v-tabs v-for="tab in pages" align-with-title grow hide-slider>
                  <!-- Display component of each tab with on click and highlight after selection -->
                  <v-tab @Click="currentPage = tab; inStore = false; currentTable = 'active';" class="rounded-lg rounded-b-0"
                        v-bind:class="{ 'blue-grey lighten-4 deep-purple--text lighten-3 disabled' : currentPage === tab}">
                    <v-badge v-if="tab == 'View Orders'"
                          color="deep-purple lighten-2"
                          :content="orderList.length">
                          {{ tab }}
                    </v-badge>
                    <v-badge v-else color="rgba(255, 0, 0, 0.0)">
                          {{ tab }}
                    </v-badge>
                    
                  </v-tab>
                </v-tabs>
              </template>
            </v-app-bar>

            <!--====== Main page content in main card component ======-->
            <main >
            <!-- Change max-height to auto to disable scroll header and remove 2nd scroll -->
              <v-sheet
                    style="margin-top: 225px;"
                    max-height="auto">
                
                <v-container  style="height: 650px;">

                  <!--======= Inventory Page =======-->

                  <!-- Search Container for Inventory Page-->
                  <v-container v-if="currentPage == 'Inventory'">
                    <!-- Container for Inventory Search Area -->
                    <v-container>
                      <v-row>
                        <v-col>
                          <!-- Search Inventory Text Input field -->
                          <v-text-field outlined autofocus  hide-details label="Search for a Card" placeholder="Cards in Inventory"></v-text-field>
                        </v-col>
                        <v-col>
                          <!-- Submit Inventory Search Button-->
                          <v-btn class="mt-2">Submit</v-btn>
                        </v-col>
                        <!-- Fun Data to Display -->
                        <v-col>
                          <v-icon>
                            mdi-currency-usd
                          </v-icon>
                        </v-col>
                        <v-col>
                          <v-icon>
                            mdi-cards-outline
                          </v-icon>
                          <h2>{{ getTotalCards(cardList) }}</h2>
                        </v-col>
                      </v-row>
                    </v-container>
                    <!-- Search Results displayed using small image uri from scryfall -->
                    <v-row>
                      <v-col class="pr-0 pl-3" cols="auto" v-for="item, index in cardList">                      
                        <v-card min-width="146" class="mx-4">

                          <v-img
                              height="204"
                              :src="item.image_uris.small"
                              contain>
                          </v-img>
                  
                        </v-card>
                      </v-col>
                    </v-row> 
                    
                    <!-- ================Page Info Dialog Page ===================== -->
                  <template>
                    <div class="text-center">
                      <v-dialog
                        v-model="dialog"
                        width="800"
                      >
                        <template v-slot:activator="{ on, attrs }">
                          <v-btn
                            color="red lighten-2"
                            dark
                            v-bind="attrs"
                            v-on="on"
                          >
                            Click Me
                          </v-btn>
                        </template>
                  
                        <v-card>
                          <v-card-title class="text-h5 grey lighten-2">
                            Privacy Policy
                          </v-card-title>
                  
                          <v-card-text>
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
                          </v-card-text>
                  
                          <v-divider></v-divider>
                  
                          <v-card-actions>
                            <v-spacer></v-spacer>
                            <v-btn
                              color="primary"
                              text
                              @click="dialog = false"
                            >
                              I accept
                            </v-btn>
                          </v-card-actions>
                        </v-card>
                      </v-dialog>
                    </div>
                  </template>

                  </v-container>
                  

                  <!--===== Vuetify Add Card Page =====-->

                  <!--=== Add Card Page Vuetify Card ===-->
                  <v-card v-if="currentPage == 'Add Card'" class="pb-4 mx-1">
                    <!--= Sub Menu with Search/*Deck/Pile-Cart -->
                    <v-tabs grow slider-color="deep-purple lighten-2" class="rounded-lg blue-grey lighten-1">

                      <v-tab class="rounded-lg" @Click="addCardSubPage = 'Search'"
                        active-class="blue-grey lighten-4 deep-purple--text lighten-3 disabled">
                        Search
                      </v-tab>

                      <!-- <v-tab @Click="addCardSubPage = Deck" class="rounded-lg mx-2"
                        active-class="blue-grey lighten-4 deep-purple--text lighten-3 disabled">
                        Deck
                        </v-tab> -->

                      <v-tab @Click="addCardSubPage = 'Pile'" class="rounded-lg"
                        active-class="blue-grey lighten-4 deep-purple--text lighten-3 disabled">
                        Pile
                      </v-tab>

                    </v-tabs>
                    <!--= Search subPage  =-->
                    <v-container v-if="addCardSubPage == 'Search'">
                      <!-- Search field container -->
                      <v-container>
                        <v-row>
                          <v-col cols="6">
                            <v-text-field outlined label="Search for a Card" placeholder="Magic the Gathering Cards Only"
                                      v-model="searchName" @keypress.enter="getSearch()" 
                                      ref="searchInput"
                                      autofocus>
                            </v-text-field>
                          </v-col>
                          <v-col cols="auto">
                            <v-btn class="mt-2" @Click="getSearch()" >Submit</v-btn>
                          </v-col>
                          <v-col cols="auto">
                            <v-btn class="mt-2" @Click="getRandomCard()">Feeling Lucky</v-btn>
                          </v-col>
                          <v-col cols="auto">
                            <v-btn class="mt-2" @Click="resetAddCardSearch()">Reset</v-btn>
                          </v-col>
                          
                        </v-row>
                        
                      </v-container>
                      <v-row v-if="searchResults.length > 0"><v-container><v-col> Total Matching Cards: {{ this.searchResultsStats.total_cards }}</v-col></v-container></v-row>
                      <!-- Area to display search results for add card -->
                      <v-row>
                        
                        <!--****** the v-for of the search results list will go here -->
                        <v-col v-for="result in searchResultsPaginated" >
                          <!--****** Card template that will be displayed by v-for -->
                          <v-card width="146" class="mx-4">

                            <template slot="progress">
                              <v-progress-linear
                                    color="deep-purple"
                                    height="10"
                                    indeterminate>
                              </v-progress-linear>
                            </template>

                            <v-img
                                height="204"
                                :src="getSmallImgURI(result)">
                            </v-img>
                            
                            <v-card-text class="pt-1 pb-0">                     
                              
                              <!-- NM button on Add Card Search -->
                              <v-row>
                                <v-col class="pl-0" style="min-width: 30px; max-width: 48px;">
                                  <v-badge
                                        color="deep-purple lighten-2"
                                        :content="result.totalConditions.NM"
                                        :value="result.totalConditions.NM > 0"
                                        class="pl-0"
                                        offset-x="15"
                                        offset-y="12"
                                        left>
                                    <v-btn small rounded min-width="10" max-width="35" @click="addNMtoObject(result)" @click.ctrl="removeNMtoObject(result)">NM</v-btn>
                                  </v-badge>
                                </v-col>
                                <v-col style="min-width: 30px; max-width: 48px;">
                                  <v-badge
                                        color="deep-purple lighten-2"
                                        :content="result.totalConditions.LP"
                                        :value="result.totalConditions.LP > 0"
                                        class="pl-0"
                                        offset-x="15"
                                        offset-y="12"
                                        left>
                                    <v-btn small rounded min-width="10" max-width="35" @click="addLPtoObject(result)" @click.ctrl="removeLPtoObject(result)">LP</v-btn>
                                  </v-badge>
                                </v-col>                             
                                <v-col style="min-width: 30px; max-width: 48px;">
                                  <v-badge
                                        color="deep-purple lighten-2"
                                        :content="result.totalConditions.MP"
                                        :value="result.totalConditions.MP > 0"
                                        class="pl-0"
                                        offset-x="15"
                                        offset-y="12"
                                        left>
                                    <v-btn small rounded min-width="10" max-width="35" @click="addMPtoObject(result)" @click.ctrl="removeMPtoObject(result)">MP</v-btn>
                                  </v-badge>
                                </v-col>
                              </v-row>

                              <v-row>
                                <v-col class="pt-1" style="min-width: 30px; max-width: 70px;">
                                  <v-badge
                                        color="deep-purple lighten-2"
                                        :content="result.totalConditions.HP"
                                        :value="result.totalConditions.HP > 0"
                                        class="pl-0"
                                        offset-x="15"
                                        offset-y="12"
                                        left>
                                    <v-btn small rounded min-width="10" max-width="50" @click="addHPtoObject(result)" @click.ctrl="removeHPtoObject(result)">HP</v-btn>
                                  </v-badge>
                                </v-col>
                                <v-col class="pt-1" style="min-width: 30px; max-width: 70px;">
                                  <v-badge
                                        color="deep-purple lighten-2"
                                        :content="result.totalConditions.DMG"
                                        :value="result.totalConditions.DMG > 0"
                                        class="pl-0"
                                        offset-x="15"
                                        offset-y="12"
                                        left>
                                    <v-btn small rounded min-width="10" max-width="50" @click="addDMGtoObject(result)" @click.ctrl="removeDMGtoObject(result)">DMG</v-btn>
                                  </v-badge>
                                </v-col>
                              </v-row>

                              <!--=== Card Finishes ===-->
                              <v-divider></v-divider>
                              <v-card-text class="pt-2 pb-2 py-1">
                                <v-chip-group
                                
                                  active-class="deep-purple accent-4 white--text"
                                  column
                                  mandatory
                                  max="1">
                                  <v-chip v-for="finish in vFinishes(result.finishes, result)" @Click="updateCardFinish(result, finish)">{{ finish }}</v-chip>
                                  
                                </v-chip-group>
                                <p>{{ getCardPrice(result) }}</p>
                                  <p>{{result.finish}}</p>
                              </v-card-text>
                              <v-divider></v-divider>

                              <!-- OLD CODE -->
                              <!-- <v-row>
                                <v-checkbox
                                      class="deep-purple--text lighten-2"
                                      label="Foil?"
                                      color="deep-purple lighten-2"
                                      value="foil"
                                      hide-details>
                                </v-checkbox>
                              </v-row> -->


                            </v-card-text>
                            <!-- Add Button on cards displayed in add to pile -->
                            <v-row class="mx-1">
                              <v-card-actions class="pt-0 pl-1 pr-1">
                                <v-btn
                                  color="deep-purple lighten-2"
                                  text
                                  @click="addToPile(result)"
                                  class="float-end">
                                  Add
                                </v-btn>
                              </v-card-actions>
                            </v-row>
                          </v-card>
                        </v-col>
                      </v-row>
                    </v-container>
                    <!--===== Pile/Cart Page =====-->
                    <v-container v-if="addCardSubPage == 'Pile'">
                      <!-- trying floating button -->
                      <v-btn
                            v-scroll="onScroll"
                            v-show="fab"
                            fab
                            dark
                            fixed
                            bottom
                            right
                            color="primary"
                            @click="toTop">
                        <v-icon>keyboard_arrow_up</v-icon>
                      </v-btn>
                      <v-container v-if="pileList.length == 0">
                        <h3 align-content="center">No Cards Added to Pile</h3>
                      </v-container>
                      <v-container v-if="pileList.length > 0">
                        <v-row >
                          <v-col>
                            <v-card class="float-right mx-3">
                            
                            <v-btn>Get Locations</v-btn>
                            <v-btn @Click="newCard(pileList)" :loading="addPileLoading">Add to Inventory</v-btn>
                            
                            </v-card>
                          </v-col>
                        </v-row>
                      
                        <v-row v-for="pileCard in pileList">
                          <v-col>
                            <v-card>
                              <v-card width="146" class="mx-4">
    
                                <v-img
                                    height="204"
                                    :src="getSmallImgURI(pileCard)">
                                </v-img>


                              </v-card>
                            </v-card>
                          </v-col>
                        </v-row>
                      </v-container>
                    </v-container>
                  </v-card>

                  <!--=== View Orders ===--->
                  <div id="view-orders" v-if="currentPage == 'View Orders'">
                    <div v-if="inStore == false">
                    <v-row class="justify-end">
                      <!-- <v-btn @click="viewOrderSubPage = 'inStore'" class="pa-6 my-6"><h3>In Store</h3></v-btn> -->
                      <v-btn @click="inStore = true" class="pa-6 my-6"><h3>In Store</h3></v-btn>
                    </v-row>
                    <v-row> 
                      <v-col v-for="btn in tableFilters"><v-chip x-large @click="currentTable = btn" class="px-16 py-6 grey lighten-1 white--text">{{ btn.toUpperCase() }}</v-chip></v-col> 
                    </v-row>

                    <template>
                      <v-simple-table class="mt-6">
                        <template v-slot:default>
                          <thead>
                            <tr>
                              <th width="300px" class="text-left">
                                Order Number
                              </th>
                              <th width="300px" class="text-left">
                                Direct
                              </th>
                              <th width="300px" class="text-left">
                                Status
                              </th>
                              <th width="50px" class="text-left"></th>
                            </tr>
                          </thead>
                          <tbody>
                            
                            <tr v-for="order, index in orderList"
                                  :key="order.name"
                                  :class="{'blue':order.direct}">                            
                              <td v-if="checkOrder(order)">{{ order.number }}</td>
                              <td v-if="checkOrder(order)"> <v-icon v-if="order.direct" id="checkMark"> mdi-check-bold </v-icon> <v-icon v-else id="xOut">mdi-close-circle</v-icon> </td>
                              <td v-if="checkOrder(order)">{{ order.status }}</td>
                              <td v-if="checkOrder(order)"><v-checkbox></v-checkbox></td>
                            </tr>
                          </tbody>
                        </template>
                      </v-simple-table>
                    </template>
                    <v-row class="justify-end">
                      <v-btn class="pa-6 my-6"><h3>Progress</h3></v-btn>
                    </v-row>
                  </div>



                    <!-- ================IN STORE PAGE================== -->
                    <div id="in-store" v-if="inStore == true">
                      <div>
                      <v-container>
                        <!-- v-if="viewOrderSubPage = 'inStore'" -->
                        <!-- Container for Inventory Search Area -->
                        <v-container>
                          <v-row>
                            <v-col>
                              <!-- Search Inventory Text Input field -->
                              <v-text-field outlined autofocus  hide-details label="Search for a Card" placeholder="Cards in Inventory"></v-text-field>
                            </v-col>
                            <v-col>
                              <!-- Submit Inventory Search Button-->
                              <v-btn class="mt-2">Submit</v-btn>
                            </v-col>
                            </v-row>
                        </v-container>
                      </v-container>
                      </div>
                      <!-- =============== In Store Buy Table================= -->
                      <div>
                        <v-row>
                          <v-col>
                        <template>
                          <v-simple-table class="mt-6">
                            <template v-slot:default>
                              <thead>
                                <tr>
                                  <th width="350px" class="text-left">
                                    Name
                                  </th>
                                  <th width="200px" class="text-left">
                                    Foil
                                  </th>
                                  <th width="200px" class="text-left">
                                    Condition
                                  </th>
                                  <th width="125px" class="text-left">Price</th>
                                  <th width="50px" class="text-left">Remove</th>
                                </tr>
                              </thead>
                              <tbody>
                                
                                <tr v-for="card, index in inStorePile"
                                      :key="card.name"
                                      :class="{'blue':order.direct}">                            
                                  <td>{{card.name}}</td>
                                  <td>{{card.foil}}</td>
                                  <td>{{card.condition}}</td>
                                  <td>{{card.price}}</td>
                                  <td><v-checkbox></v-checkbox></td>
                                </tr>
                              </tbody>
                            </template>
                          </v-simple-table>
                        </template>
                     
                      </v-row>
                      <v-row class="justify-end mt-6">
                      
                        <v-btn class="pa-6"><h2>BUY</h2></v-btn>
                      </v-col>
                      </v-row>
                      </div>




                    </div>






                  </div>

                    <!--=== Add Order Page ===-->
                    <div id="add-orders" v-if="currentPage == 'Add Order'">
                      <button @click="addOrderSubPage = 'searchCard'" :disabled="addOrderSubPage == 'searchCard'">search an order</button>
                      <button @click="addOrderSubPage = 'addToPile'" :disabled="addOrderSubPage == 'addToPile'">confirm add</button>
                      <button @click="addOrderSubPage = 'pile'" :disabled="addOrderSubPage == 'pile'">my pile</button>
                      <div class="search-card" v-if="addOrderSubPage == 'searchCard'">
                        Search Card
                      </div>
                      <div class="add-to-pile" v-if="addOrderSubPage == 'addToPile'">
                        Add To Pile
                      </div>
                      <div class="pile" v-if="addOrderSubPage == 'pile'">
                        Pile
                        <!-- <div v-for="card in orders">{{ orderCard }}</div> --> 
                        Order Number: <input v-model="orderNumber" type="text">
                        Total Price: $<input v-model="orderPrice" type="text">
                        Direct? <input type="checkbox" v-model="directStatus">
                        <button @click="newOrder()">Add to Inventory</button>
                      </div>
                    </div>
                  </div>
                </v-container>
              </v-sheet>
            </main>        
          </v-container>
        </v-card>
      </v-app>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
    <script src="app.js"></script>
  </body>
</html>
